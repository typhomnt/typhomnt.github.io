<!DOCTYPE html><html lang="en-us" >

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  

  
  
  
    
  
  <meta name="description" content="Introduction to NPR inside Blender for a basic but complete shader.">

  
  <link rel="alternate" hreflang="en-us" href="http://typhomnt.github.io/post/blender_npr/">

  


  
  
  
  <meta name="theme-color" content="hsl(200, 90%, 68%)">
  

  
  
  
  <script src="/js/mathjax-config.js"></script>
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light" disabled>
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark">
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_box_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_box_center_2.png">

  <link rel="canonical" href="http://typhomnt.github.io/post/blender_npr/">

  
  
  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@typhomnt">
  <meta property="twitter:creator" content="@typhomnt">
  
  <meta property="og:site_name" content="Maxime Garcia">
  <meta property="og:url" content="http://typhomnt.github.io/post/blender_npr/">
  <meta property="og:title" content="Making a NPR Shader in Blender | Maxime Garcia">
  <meta property="og:description" content="Introduction to NPR inside Blender for a basic but complete shader."><meta property="og:image" content="http://typhomnt.github.io/post/blender_npr/featured.png">
  <meta property="twitter:image" content="http://typhomnt.github.io/post/blender_npr/featured.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2021-09-26T16:22:09&#43;01:00">
    
    <meta property="article:modified_time" content="2021-09-26T16:22:09&#43;01:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://typhomnt.github.io/post/blender_npr/"
  },
  "headline": "Making a NPR Shader in Blender",
  
  "image": [
    "http://typhomnt.github.io/post/blender_npr/featured.png"
  ],
  
  "datePublished": "2021-09-26T16:22:09+01:00",
  "dateModified": "2021-09-26T16:22:09+01:00",
  
  "publisher": {
    "@type": "Organization",
    "name": "Maxime Garcia",
    "logo": {
      "@type": "ImageObject",
      "url": "http://typhomnt.github.io/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_box_center_2.png"
    }
  },
  "description": "Introduction to NPR inside Blender for a basic but complete shader."
}
</script>

  

  


  


  





  <title>Making a NPR Shader in Blender | Maxime Garcia</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="dark">

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Maxime Garcia</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Maxime Garcia</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/post"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/research"><span>Research</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/teaching"><span>Teaching</span></a>
        </li>

        
        

        

        
        
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/art"><span>Art</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      

      

    </ul>

  </div>
</nav>


  
<div class="container-fluid docs">
    <div class="row flex-xl-nowrap">
      <div class="d-none d-xl-block col-xl-2 docs-toc">
        <ul class="nav toc-top">
          <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
        </ul>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#shader-structure-">Shader Structure</a></li>
    <li><a href="#diffuse-component-">Diffuse Component</a>
      <ul>
        <li><a href="#playing-with-color-ramps-">Playing with color ramps</a></li>
        <li><a href="#metallic-diffusion--">Metallic Diffusion ?</a></li>
        <li><a href="#light-color-influence-">Light Color Influence</a></li>
        <li><a href="#smoothness-and-responsiveness-">Smoothness and Responsiveness</a></li>
      </ul>
    </li>
    <li><a href="#specular-component-">Specular Component</a></li>
    <li><a href="#ambient-occlusion-">Ambient Occlusion</a></li>
    <li><a href="#emission-component-">Emission Component</a></li>
    <li><a href="#rim-light-and-outline-">Rim Light and Outline</a>
      <ul>
        <li><a href="#extracting-the-contours-">Extracting the contours</a></li>
        <li><a href="#outline-">Outline</a></li>
        <li><a href="#rim-light-">Rim light</a></li>
      </ul>
    </li>
    <li><a href="#sub-surface-scaterring-">Sub-Surface Scaterring</a>
      <ul>
        <li><a href="#approximated-sss-">Approximated SSS</a></li>
        <li><a href="#inverse-diffuse-lighting-">Inverse Diffuse Lighting</a></li>
        <li><a href="#final-sss-node-group-">Final SSS Node Group</a></li>
      </ul>
    </li>
    <li><a href="#blending-components-">Blending Components</a></li>
    <li><a href="#limitations-">Limitations</a></li>
    <li><a href="#going-further--">Going further ?</a></li>
    <li><a href="#tutorial-files-">Tutorial Files</a></li>
  </ul>
</nav>
        
      </div>
      <main class="col-12 col-md-0 col-xl-10 py-md-3 pl-md-5 docs-content" role="main">

        <article class="article">
            




















  
  
    
  


<div class="article-container pt-3">
  <h1>Making a NPR Shader in Blender</h1>

  

  


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Sep 26, 2021
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    22 min read
  </span>
  

  
  
  

  
  

</div>

  














</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 720px; max-height: 405px;">
  <div style="position: relative">
    <img src="/post/blender_npr/featured_hu772cc35029d0854780ab7eab1b34382a_2200754_720x0_resize_box_2.png" alt="" class="featured-image">
    
  </div>
</div>


            <div class="article-container">
              <div class="article-style">
                <p>This article is the result of my first attempt at making an NPR shader inside Blender.</p>
<p>I first tried to play around the shading node system as well as the post processing effects like Ambient Occlusion or Bloom and test various things. As I would like to focus on &ldquo;real-time&rdquo; rendering, I tested everything with the EEVEE rendering engine. I also looked at many videos and works that have been done inside Blender for NPR.</p>
<p>If you are interested in the subject, you can take a look at (or even join) the 
<a href="https://www.facebook.com/groups/BNPRandFreestyle" target="_blank" rel="noopener">Blender NPR community</a> and also check out the Lightning Boy Studio 
<a href="https://www.youtube.com/channel/UCd9i2MKimSaKezat1xkn8-A" target="_blank" rel="noopener">youtube channel</a>, there are many resources for that field.</p>
<p>In this article, I am going to describe a simple version of a Blender shader NPR that I built. Of course, I took inspiration from what is available on the Internet and also tried to propose my own vision. It is very far from perfect but I hope it will give you a basic understanding in order to start exploring NPR on your own.</p>
<h2 id="shader-structure-">Shader Structure</h2>
<p>The shader is represented as a node group which itself is divided into several groups that correspond to light contributions.
More precisely, this NPR shader light contributions are divided into 5 components: Diffuse, Specular, Ambient occlusion, Sub-Surface Scattering (SSS) and Emission.
Furthermore, I also include Rim light and Outline contributions which are heavily present in NPR shaders.</p>
<p>First let me tease the kind of results you can obtain with this shader.</p>
<p><img src="/Images/NPR/Blender_NPR/Clare_2.png" alt="NPR Example">
<img src="/Images/NPR/Blender_NPR/Clare_1.png" alt="NPR Example"></p>
<p style="text-align: center;"> model: Clare by ruslik85 on Sketchfab </p>
<p>As you can see the range of rendering styles can vary from very cartoonish shading to more realistic results.
Below, you can notice the difference compared to a more realistic look using the principled Shader (model: Ruby Rose by theStoff on Sketchfab) :</p>
<table>
<thead>
<tr>
<th align="center">Realistic</th>
<th align="center">Cartoon</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><video autoplay loop muted controls><source src="/Videos/NPR/Blender_NPR/Realistic_Animated.mp4" type="video/mp4"></video></td>
<td align="center"><video autoplay loop muted controls><source src="/Videos/NPR/Blender_NPR/NPR_Animated.mp4" type="video/mp4"></video></td>
</tr>
</tbody>
</table>
<p>The main tool to make such variations is to use color ramps to tweak the output of base shaders, like the Diffuse or Glossy (Specular) shaders.
There is more to it of course, and we will go into details in the next sections.</p>
<p>As you can see, the NPR look is more contrasted and &ldquo;flashier&rdquo; than the realistic look. It also while masks details at the same time.
However, thanks to effects like Outline and Rim Light, we are also able to make relevant parts of the model (like the silhouettes) stand out.
This is especially useful to improve the perception of characters&rsquo; poses and their motion.</p>
<p>This simple Blender NPR shader is build as a node group that can be tweaked with numerous parameters:</p>
<p>
<a href="/Images/NPR/Blender_NPR/NPR_Mat.PNG"><img src="/Images/NPR/Blender_NPR/NPR_Mat.PNG" alt="NPR Material"></a></p>
<p>And here is an overview of what the inside node group looks like:</p>
<p>
<a href="/Images/NPR/Blender_NPR/NPR_Group.PNG"><img src="/Images/NPR/Blender_NPR/NPR_Group.PNG" alt="NPR Group"></a></p>
<p>This node group is itself divided into 7 sub-groups, each corresponding to different light contributions. We then blend them together by choosing an appropriate blending operation. Each of these contributions will be detailed in its own section as well as their blending.</p>
<p>Let&rsquo;s first dig into each component independently for a scene containing a plane, a sphere, Suzanne and a sun light.</p>
<blockquote>
<p><strong><em>NOTE:</em></strong> Before going further, it is important to switch the color management to Standard in the Render Properties panel as we want to control our color output precisely <img src="/Images/NPR/Blender_NPR/Color_Managment.PNG" alt="Color Managment"></p>
</blockquote>
<h2 id="diffuse-component-">Diffuse Component</h2>
<p>
<a href="/Images/NPR/Blender_NPR/Diffuse_Group.PNG"><img src="/Images/NPR/Blender_NPR/Diffuse_Group.PNG" alt="Diffuse Group"></a></p>
<p>The diffuse component represents the amount of light re-emitted by the surface after receiving incoming light, here coming from lamps. This amount can be obtained using the Diffuse BRDF node which computes a physically based diffusion.</p>
<p>As our objective is to produce stylized results, we would like to tweak this output and have some artistic control over it.
Here comes into play the basic node that everyone uses in the NPR community, namely the ShaderToRGB Node. Indeed, this magic node converts the shader output into a color (works only for EEVEE at the time I write this article) and lets us tweak this output color.</p>
<p>One convenient way of tweaking this color is to use a Color Ramp which allows us to remap an input color into an interpolated color computed from parameterized colors spread into a $ [0:1] $ range. The control offered by color ramps is pretty intuitive and thus, it makes a good candidate for us to use in our stylization process.
To tweak the diffuse component we will proceed the following way: first set the albedo of the surface as pure white in the diffuse shader and plug the output color (after ShaderToRGB) as the input of a ColorRamp.
Then we can modify the color ramp content to stylize the diffuse contribution.
And finally, we can get back the color of the surface we actually want (diffuse albedo) by multiplying the output of the color ramp with the surface color.</p>
<blockquote>
<p><strong><em>NOTE:</em></strong> Note that I use a Separate HSV node right after ShaderToRGB to use the <strong>value</strong> of the input color as it is the only attribute that interests us.</p>
</blockquote>
<p><img src="/Images/NPR/Blender_NPR/Diffuse_1.png" alt="Diffuse Example">
<img src="/Images/NPR/Blender_NPR/Diffuse_1_Mat.png" alt="Diffuse Example"></p>
<p>That&rsquo;s a good start, but several questions need to be answered: how do we modify the color ramp to get a stylized result ? What about metallic materials ? How to get back the influence of the incoming light color which is discarded with our current setup ?</p>
<h3 id="playing-with-color-ramps-">Playing with color ramps</h3>
<p>We were able to get the light contribution of the Diffuse component inside a color ramp, it is now time to play with it in order to stylize this contribution.
To do it properly, we first need to understand what is happening inside the Diffuse node and think about how we can get closer to a stylized result like we can see in cartoons/anime.</p>
<p>To put it simply, the Diffusion or the light re-emitted by the surface of an object hit by light, depends on the surface orientation, referred as the normal $N$, with respect to the incoming direction of the light $L$. If the surface faces the incoming light direction it will re-emit more light. This can be simply modeled using a dot product between L and N of the surface.</p>
<p>$$ D_{iffuse} \approx max(-L \cdot N,0) $$
<img src="/Images/NPR/Blender_NPR/Diffuse_Fig.png" alt="Diffuse Fig"></p>
<p>This is the basic computation that occurs inside the Diffuse node (it is a little bit more complicated in practice but let&rsquo;s keep it simple in this tutorial).
For smooth surfaces like humanoid characters, this Diffuse contribution also varies in a smooth fashion alongside the model, which is not the case when you look at cartoons/anime.
Usually you get one, two or three grading levels with abrupt changes.</p>
<p>To get these results with the color ramp, we simply have to add levels to the ramp (press the &lsquo;+&rsquo; button inside the ramp) and change the interpolation mode to constant, restraining the number of light levels diffused by the model to a fixed number.</p>
<p><img src="/Images/NPR/Blender_NPR/Diffuse_2.png" alt="Diffuse Example">
<img src="/Images/NPR/Blender_NPR/Diffuse_2_Mat.PNG" alt="Diffuse Example"></p>
<p>Et voila ! you get a cartoonish/anime shading. You are free to tweak the levels at your own convenience as well as to use a smoother interpolation and even mix the discrete and smooth Diffusion, like I suggest in the final version of the Diffuse shader.</p>
<h3 id="metallic-diffusion--">Metallic Diffusion ?</h3>
<p>As you probably guess there is something to take into account with metallic materials regarding Diffusion.
Indeed, something to know is that metallic materials do not diffuse light, only absorbing and reflecting it.</p>
<p>That&rsquo;s why we took it into consideration by multiplying the result of the diffusion with $ 1 - metalness $.</p>
<p><img src="/Images/NPR/Blender_NPR/Diffuse_3.png" alt="Diffuse Example">
<img src="/Images/NPR/Blender_NPR/Diffuse_3_Mat.PNG" alt="Diffuse Example"></p>
<h3 id="light-color-influence-">Light Color Influence</h3>
<p>Using our current node configuration, you can notice that changing the light color has no effect on the shading of our objects.</p>
<p><img src="/Images/NPR/Blender_NPR/Diffuse_Light_Influence_Objs.PNG" alt="Light Influence Off">
<img src="/Images/NPR/Blender_NPR/Diffuse_Light_Influence.PNG" alt="Light Influence On"></p>
<p>And this is due to the fact that we use the output of the gray scaled color ramp as the Diffuse light contribution. And so, light color influence is something we lost from the Diffuse BSDF that takes this factor into account.
The question is how to get it back ?
The answer is quite simple. As we already recover the light intensity of our shading (<strong>value</strong> of the HSV node) we just have to get back the <strong>hue</strong> and <strong>saturation</strong> resulting from  a multiplication between the object color and the light color.</p>
<p><img src="/Images/NPR/Blender_NPR/Diffuse_Light_Influence_Objs_On.PNG" alt="Light Influence On">
<img src="/Images/NPR/Blender_NPR/Diffuse_Light_Influence_Objs_On_Mat.PNG" alt="Light Influence On Mat"></p>
<h3 id="smoothness-and-responsiveness-">Smoothness and Responsiveness</h3>
<p>It is also possible to give more artistic control to the Diffuse component, and this is something we will also use for the Specular contribution.</p>
<p>First, it is very handy to add a smoothness control to your Diffuse shading.
And this can be done easily by adding a second color ramp with a linear interpolation this time, and blend it with the previous color ramp we built using a Mix Color node and a smoothness parameter.</p>
<p>Secondly, it can also be useful to add a control that tweaks the amount of light re-emitted using a Map range node that maps $ [a : b] $ to $ [c : d] $. Here, we use an attenuation parameter that we plug as $b$ so that $ [0:b] $ gets mapped into $ [0:1] $, thus the higher $b$ is the less light will be re-emitted.</p>
<p><img src="/Images/NPR/Blender_NPR/Diffuse_4.png" alt="Diffuse Example">
<img src="/Images/NPR/Blender_NPR/Diffuse_4_Mat.PNG" alt="Diffuse Example"></p>
<h2 id="specular-component-">Specular Component</h2>
<p>The Specular component represents the amount of incoming light that is reflected by the object surface.
One simple way of formulating its contribution is : from the camera point of view, how well does it see the light source reflected on the object ?</p>
<p>The simplest model describing this contribution has been introduced by Phong, and simply look at the dot product between the reflected light vector $ R = reflect(L,N) $ and the view vector $ V $.</p>
<p>$$ S_{pecular} \approx R \cdot V $$
<img src="/Images/NPR/Blender_NPR/Specular_Fig.png" alt="Specular Fig"></p>
<p>Inside Blender, computations are more complicated as it relies on physically-based algorithms and I invite you to take a look at my 
<a href="../../teaching/ray_tracing/pbr_intro">Physically-Based Rendering tutorial</a> if you want to know more about it.</p>
<p>The way we will implement this component is highly similar to what we did for the Diffuse component and thus I will not detail everything in this section.</p>
<p>
<a href="/Images/NPR/Blender_NPR/Specular_Group.PNG"><img src="/Images/NPR/Blender_NPR/Specular_Group.PNG" alt="Specular Group"></a></p>
<p>The first thing to note is that I used the Principled BRDF node to get the specular component as the other nodes don&rsquo;t provide support for metallic materials. As we are only interested in the Specular component here, I put a perfectly black color for the base color, so that we remove the Diffuse contribution provided by the Principled BRDF node. I also put the specular parameter at $1$ and plugged in the roughness parameter that plays a big role for that contribution. It is also important to notice that the metallness used is actually 1 minus the metalness and this is for stylization purposes.</p>
<p>The rest of the Specular node group is exactly the same as the Diffuse component. We sample the intensity (or <strong>value</strong>) of the Specular contribution using color ramps, possibly attenuating it beforehand, and mix the result with the specular color and the light color influence.</p>
<p><img src="/Images/NPR/Blender_NPR/Specular.png" alt="Specular Example"></p>
<blockquote>
<p><strong><em>NOTE:</em></strong> A small note for metallic materials. To enhance the look of metallic materials, you might use an environment map for the World material to get more reflections and thus a more believable look.
<img src="/Images/NPR/Blender_NPR/World_Mat_Env.PNG" alt="World Mat"></p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">No Env Map</th>
<th align="center">Env Map on</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><video autoplay loop muted controls><source src="/Videos/NPR/Blender_NPR/Magnemite_1.mp4" type="video/mp4"></video></td>
<td align="center"><video autoplay loop muted controls><source src="/Videos/NPR/Blender_NPR/Magnemite_2.mp4" type="video/mp4"></video></td>
</tr>
</tbody>
</table>
<h2 id="ambient-occlusion-">Ambient Occlusion</h2>
<p>Ambient Occlusion (AO) is actually not a light contribution but more like a shadow contribution. It describes the area of the scene where light rays are less likely to hit.
This is especially the case of corners and creases and it is quite noticeable if you look at your room for instance.</p>
<p>Ambient occlusion greatly enhances the realism of real-time renders and is something that artists are aware of when drawing and painting.
In our case, we would like to use it to give more contrast and color variation to our renders.</p>
<p>The first thing to do when using EEVEE, is to enable Ambient Occlusion in the Render Properties tab.
<img src="/Images/NPR/Blender_NPR/Ambient_Occlusion_Panel.PNG" alt="Ambient Occlusion Panel"></p>
<p>There are a couple of parameters like the Distance, Factor and Trace Precision as well as Bents Normals and Bounces Approximation. I won&rsquo;t go into details on how Ambient Occlusion is computed but for our purpose let&rsquo;s keep Factor and Trace Precision at 1 and enable Bents Normals and Bounces Approximation. The distance in this tab is not relevant and will be tweakable from the Ambient Occlusion node directly.</p>
<p><img src="/Images/NPR/Blender_NPR/Ambient_Occlusion_Group.PNG" alt="Ambient Group">
<img src="/Images/NPR/Blender_NPR/ambient_occlusion.png" alt="Ambient Example"></p>
<p>Like for Diffusion and Specular Reflexion, we use a color ramp to limit the number of grayscale levels AO can contribute to.
Notice that I limited AO to two levels for the cartoonish/anime shading as it is often more subtle than the previous components.</p>
<p>You will also have to adjust the Distance parameter depending on the scale of your model, especially for small and large models. In the first case your model might be fully occluded while in the second case you might not notice any occlusion if you don&rsquo;t tune this parameter carefully.<br>
I also added a Math power node to tweak the contrast of AO and give it more importance.</p>
<p>Finally, to further increase the color contrast, we assign a color to the non occluded areas with a Multiply node.</p>
<h2 id="emission-component-">Emission Component</h2>
<p>The emissive contribution is the easiest to take into account as Blender already does all the work for us with the Emissive shader.</p>
<p>However, it is important to note that when using EEVEE and real-time renderers, you have to enable Bloom to get a greater impact.
<img src="/Images/NPR/Blender_NPR/Bloom_Panel.PNG" alt="Bloom Panel"></p>
<p>It is a post-processing effect that highlights the brightest parts of your scene which is the case of emissive materials.
This is something widely used in video games to make fire, lasers, lamps and other special effects to stand out.
As you can see, there are also few parameters to tune the Bloom effect. You might want to tweak the Threshold parameter that determines when a given color intensity (<strong>value</strong>) is considered as bright.</p>
<p>Notice the difference when Bloom is enabled.</p>
<table>
<thead>
<tr>
<th align="center">No Bloom</th>
<th align="center">Bloom On</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img src="/Images/NPR/Blender_NPR/Emission.png" alt="Emission Example"></td>
<td align="center"><img src="/Images/NPR/Blender_NPR/Emission_Bloom.png" alt="Emission Example"></td>
</tr>
</tbody>
</table>
<p><img src="/Images/NPR/Blender_NPR/Emission_Group.PNG" alt="Emission Group"></p>
<p>Currently it is quite costly to handle emissive materials as light sources in a real-time fashion.
Handling emissive materials like path tracers (Cycles in Blender) might change in the future with real time ray tracing being faster and more optimized.</p>
<h2 id="rim-light-and-outline-">Rim Light and Outline</h2>
<p>Rim lighting and Outline are tools used by artists to better depict the contours and the pose of characters.
They can also be used to set a specific mood and to enhance the perception of motion.</p>
<h3 id="extracting-the-contours-">Extracting the contours</h3>
<p>There are plenty of techniques to get the contours of a 3D model and draw art lines on top of it. There are pros and cons for each technique, but state-of-the-art methods tend to give a lot of freedom with computational costs that get shorter and shorter.

<a href="https://hal.inria.fr/hal-02189483/document" target="_blank" rel="noopener">Benard et al.</a> made a survey summarizing many existing methods to draw art lines on top of 3D models.</p>
<p>In this tutorial, I described the simplest approach which is far from being perfect and you might want to use other methods like the 
<a href="https://www.blendersecrets.org/secrets/inverted-hull-toon-outline-bnpr-blender-tutorial" target="_blank" rel="noopener">inverted hull</a>, at least for the outline.</p>
<p>The simplest way of getting the contours is to use the dot product between the view direction $ V $ and the normal $ N $.
Indeed, one way of defining parts of a 3D model that are near the silhouette is to look at where this dot product is near zero, or formulated differently, where the normal of the surface is orthogonal to the view direction.</p>
<h3 id="outline-">Outline</h3>
<p>There is an easy way to get this dot product in Blender within one node, namely the Fresnel node.
It takes into account an index of refraction which is a fundamental parameter to determine the amount of light that goes through the object, which also tells us the amount of light that gets reflected as its complementary.
This amount of light being reflected is directly linked to the dot product between the view direction $ V $ and  the normal $ N $.
And so, to get the Outline, we can use the output of the Fresnel node and threshold it with a color ramp like we did for the other components.</p>
<p><img src="/Images/NPR/Blender_NPR/Outline_Group.PNG" alt="Outline Group">
<img src="/Images/NPR/Blender_NPR/outline.png" alt="Outline Example"></p>
<h3 id="rim-light-">Rim light</h3>
<p>Rim Light is also referred as a backlight that highlights the full silhouette or only one part of it.</p>
<p>To achieve this effect with 3D geometry, we can also compute the dot product between the normal $ N $ and the camera view $ V $ to get the silhouette and use color ramps to tweak its values.
This time I intentionally computed the dot product using Vector Math nodes.</p>
<p>
<a href="/Images/NPR/Blender_NPR/Rim_Light_Group.PNG"><img src="/Images/NPR/Blender_NPR/Rim_Light_Group.PNG" alt="Rim Light Group"></a></p>
<p>We also need to limit the highlighted area to one side of the model (Side Masking). More precisely, we have to think in view space to correctly achieve this effect.
Therefore, we convert the normal into view space using the Transform node.
Basically what we want is to limit the silhouette lighting where the view space normal is aligned with a desired rim light direction.
Computing an alignment with a vector is equivalent to compute the dot product between the normal and the Rim light direction.</p>
<p>And that&rsquo;s it, using this trick we can highlight one side of the silhouette and mask the other side.</p>
<blockquote>
<p><strong><em>NOTE:</em></strong> Note that this Rim light direction is encoded as a 3D vector as Blender only supports them, but in practice we do not use the Z coordinate, hence the Vector Multiplication node.</p>
</blockquote>
<p>As a final touch, like precedently, we can use color ramps to sharpen or soften the Rim Light depending on the style you want to convey.
<img src="/Images/NPR/Blender_NPR/rim_light.png" alt="Rim Light Example"></p>
<h2 id="sub-surface-scaterring-">Sub-Surface Scaterring</h2>
<p>Sub-Surface Scattering (SSS) is one of the most difficult contributions to handle as it is also a more complex phenomena.
It corresponds to light rays that completely traverse an opaque medium, like your body, and that reaches your eye. One common example given to behold this phenomena is to place your hand between you and the sun and look at the space between your fingers, you will notice a reddish color at the silhouette of your hand. This is the light going through a thin opaque medium that is your skin.</p>
<p>Although it is a quite common phenomena, it is also very difficult to achieve in a real-time fashion and for this tutorial we will use the approximation proposed by 
<a href="https://www.alanzucconi.com/2017/08/30/fast-subsurface-scattering-1/" target="_blank" rel="noopener">Alan Zucconi</a> (based on a GDC talk) to achieve our NPR SSS inside Blender. Note that we will not use the SSS shader provided by Blender as the method proposed by Alan Zucconi offers more expressiveness and  better artistic control.
We will also extend this approach by adding two additional contributions.</p>
<h3 id="approximated-sss-">Approximated SSS</h3>
<p>In this section, I will  mostly paraphrase the tutorial of 
<a href="https://www.alanzucconi.com/2017/08/30/fast-subsurface-scattering-1/" target="_blank" rel="noopener">Alan Zucconi</a>, I will skip few details and explain how to implement it inside Blender.</p>
<p>Like I mentioned above, SSS is a complex phenomenon where light rays go through the surface and are also deviated from their incoming direction.
If we look at the simple situation of a directional light casting rays to our object, we can notice that the non lighted region should be dark for an opaque material.
However, for translucent materials this is not the case and this area should be lighted somehow.<br>
The trick to take into account this phenomena is to create a fictive light contribution from the opposite direction of the incoming light.</p>
<p>First, let&rsquo;s suppose that the incoming light from L is not deviated inside the material, that means that a viewer will best see light rays that go through the object if his gaze is aligned with L and on the contrary if it is orthogonal, he/she won&rsquo;t see light. This means that the intensity of visible traversing light is proportional to the dot product of $ V  $ and $ L $.</p>
<p>$$ I_{SSS} = clamp(V \cdot L ,0,1) $$</p>
<table>
<thead>
<tr>
<th align="center">SSS Off</th>
<th align="center">SSS On</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img src="/Images/NPR/Blender_NPR/SSS_No.png" alt="SSS Fig"></td>
<td align="center"><img src="/Images/NPR/Blender_NPR/SSS_On.png" alt="SSS On Fig"></td>
</tr>
</tbody>
</table>
<p>However, inside the object, the light undergoes some deviation and most noticeably at the object surface. So let&rsquo;s take into account the deviation of the light rays that occurs when they leave the inside of an object.
This can be done using the normal $ N $ and the subsurface distortion $\delta$ that tells how much the normal will distort the light towards an halfway direction $ (N - L) $.</p>
<p><img src="/Images/NPR/Blender_NPR/SSS_Deviation.png" alt="SSS Deviation Fig"></p>
<p>Let&rsquo;s also give more artistic control to this contribution, tweaking the contrast $ p $ and the scale $ S $with two parameters:</p>
<p>$$ I_{SSS} = clamp(V \cdot - (\delta N - L),0,1)^pS $$</p>
<p>Finally, we can also take into account the thickness of the object light rays are traversing. Indeed, the thicker the object is the more light will be absorbed and restrained inside the object.
Hence, the final formula of this approximated SSS taking into account the thickness:</p>
<p>$$ I_{SSS} = clamp(V \cdot - (\delta N - L),0,1)^pS * (1 - thickness) $$</p>
<blockquote>
<p><strong><em>NOTE:</em></strong> Getting the true thickness, meaning the distance that a light ray traversed inside the object, can be costly as its computation is based on ray tracing. Instead, we can rely on a rough approximation using Ambient Occlusion like stated by Alan Zucconi. The trick is to compute AO on the inverted faces of the model, so that we compute the occlusion of the inside of the model and get information of the local thickness which can be sufficient for our case. Thankfully, the Ambient Occlusion node Blender provides this information by checking the <strong>Inside</strong> option.
<img src="/Images/NPR/Blender_NPR/SSS_Thickness.png" alt="SSS Group"></p>
</blockquote>
<p>Now that I explained the theory behind this version of SSS, it is time to implement it inside Blender. One difficulty we encounter here with the node system, is the fact that we do not have access to the light direction $ L $.
Thankfully, there is a way to overcome this issue using Blender Drivers which are basically linking scene properties to variables inside the node editor.
However, it is important to note that SSS will only work for a unique light source and will not be taken into account for others, if you have any on your scene.</p>
<p>To get $ L $ from our main directional light we will add a CombineXYZ node and right click on the x coordinate and choose &lsquo;Add Driver&rsquo;:</p>
<p><img src="/Images/NPR/Blender_NPR/Driver.png" alt="Driver 1"></p>
<p>Then, a panel will appear that will allow you to choose the scene property that will be linked to this coordinate. Select your light source in the object field and choose its X rotation as we deal with a directional light (could be the position for a point light).</p>
<p><img src="/Images/NPR/Blender_NPR/Driver_Light.png" alt="Driver 2"></p>
<p>Repeat this process for the y and z coordinates and you get the rotation of the light inside this node. Now let&rsquo;s convert this rotation into a direction vector.
The Vector Rotation node Blender provides does exactly what we need, it applies a rotation to an input vector from the Euler angles (that we retrieve with the Drivers).
Notice that the z coordinate of the input vector is $ -1 $ so that we get $ -L $ directly from the rotation node.</p>
<p><img src="/Images/NPR/Blender_NPR/Driver_Light_Dir.png" alt="Driver 3"></p>
<p>We finally compute the dot product with the view Vector $ V $, apply the scale, thickness and power factor and get our approximated SSS contribution.</p>
<p>
<a href="/Images/NPR/Blender_NPR/SSS_Approx.png"><img src="/Images/NPR/Blender_NPR/SSS_Approx.png" alt="SSS Group"></a></p>
<p><video autoplay loop muted ><source src="/Videos/NPR/Blender_NPR/SSS_Approx.mp4" type="video/mp4"></video></p>
<h3 id="inverse-diffuse-lighting-">Inverse Diffuse Lighting</h3>
<p>It is possible to go further in the stylization of SSS by adding an additional effect which is much more &ldquo;artistic&rdquo; than the approximation I just described.
The main idea is to add the complementary of the diffuse component as a contribution in order to make non lighted areas pop out a little bit.
The contribution is divided into two parts : front inverse diffuse and back inverse diffuse. The first adds the complementary of the incoming light while the later adds the complementary of the light coming from the opposite direction.</p>
<p>Mathematically speaking :</p>
<p>$$ F_{SSS} = 1 - max(L \cdot N,0)  $$
$$ B_{SSS} = 1 - max(-L \cdot N,0)  $$</p>
<p>In the same manner as for the approximated SSS, we can add more control to these contributions :</p>
<p>$$ F_{SSS} = (1 - max(L \cdot N,0))^p*\alpha_{front} $$
$$ B_{SSS} = (1 - max(-L \cdot N,0))^p*\alpha_{back}  $$</p>
<p>And finally, the thickness of the object should also be taken into consideration:</p>
<p>$$ I_{nverse Diffuse} = ((F_{SSS} + B_{SSS})*S)^{p_i}* (1 - thickness) $$</p>
<p>
<a href="/Images/NPR/Blender_NPR/SSS_Front_Back.png"><img src="/Images/NPR/Blender_NPR/SSS_Front_Back.png" alt="SSS Group"></a></p>
<p><video autoplay loop muted ><source src="/Videos/NPR/Blender_NPR/SSS_Inverse_Diffuse.mp4" type="video/mp4"></video></p>
<h3 id="final-sss-node-group-">Final SSS Node Group</h3>
<p>The final SSS contribution results in the sum of the approximated SSS and the inverse diffuse contribution.</p>
<p>$$ SSS = (I_{SSS} + I_{nverse Diffuse})*(1 - metalness) $$</p>
<p>As metallic materials cannot be translucent, we take into account the metalness of the material with a Multiply node and nullify the contribution of the SSS if the material is a metal.</p>
<p>
<a href="/Images/NPR/Blender_NPR/SSS_All.png"><img src="/Images/NPR/Blender_NPR/SSS_All.png" alt="SSS Group"></a></p>
<p>Notice that eventually tweak the final result with color ramps to discretize or smooth the contribution.</p>
<p><video autoplay loop muted ><source src="/Videos/NPR/Blender_NPR/SSS_Example.mp4" type="video/mp4"></video></p>
<h2 id="blending-components-">Blending Components</h2>
<p>Now that we computed all the 7 different contributions, it is time to blend them together.
Diffuse, Specular and SSS components should be added together.
However, we first apply the Ambient Occlusion to the Diffuse component in Overlay mode in order to increase the contrast between the non occluded and occluded regions.
We then proceed to the SSS coloring using a simple multiplication with the SSS color. Note that, at this stage, we could decide to take into account the influence of the material color over the SSS output color.
We then successively add the SSS and the Specular component with an Add node.</p>
<p>Finally we add the Rim lighting using a Mix node so that it goes on top of all the other contributions and re-iterate this operation for the Outline that also goes on top of the Rim light.</p>
<p>Et voil√† ! We implemented our first NPR shader inside Blender !</p>
<p>
<a href="/Images/NPR/Blender_NPR/NPR_Group.PNG"><img src="/Images/NPR/Blender_NPR/NPR_Group.PNG" alt="Blending"></a></p>
<blockquote>
<p><strong><em>NOTE:</em></strong> This way of blending contributions together is one of the infinite possibilities you can test. There is no true way to blend these contributions together as we deal with NPR, so tweak these blend modes to your heart content !</p>
</blockquote>
<h2 id="limitations-">Limitations</h2>
<p>The main limitation of the shader is that it only supports one light for the main lighting and the SSS as we use drivers. If you want to add more light I recommend that you use point, spot and area lights even though the SSS won&rsquo;t be computed for these additional lights.
Additionally, Inverse Diffuse Lighting can produce artifacts when it is not properly aligned with the Diffuse contribution, and that is because we compute it as the complementary of a fake Diffuse component.
This part should be fixed and take into account the output of the true Diffuse component instead.</p>
<p>There is not too much room for stylizing metallic materials with this shader, it mainly depends on the environment map you use. This aspect can surely be improved a lot.</p>
<p>Finally, we did not cover the artifacts that are due to the topology of the model that may not be adapted to cartoon/anime style, I&rsquo;ll be definitely working on that part.</p>
<h2 id="going-further--">Going further ?</h2>
<p>From that point, I strongly encourage you to test this shader in more complex scenes like the one below. Do not hesitate to try variations, new ideas often come from testing !</p>
<table>
<thead>
<tr>
<th align="center">Sakura Tree 1</th>
<th align="center">Sakura Tree 2</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><video autoplay loop muted controls ><source src="/Videos/NPR/Blender_NPR/Sakura_Tree.mp4" type="video/mp4"></video></td>
<td align="center"><video autoplay loop muted controls ><source src="/Videos/NPR/Blender_NPR/Sakura_Tree_2.mp4" type="video/mp4"></video></td>
</tr>
</tbody>
</table>
<p>This tutorial only covers the basics but you may want to go further and include texture effects like cross hatching, stippling and watercolor. These effects may rely on noises that will disturb contributions by a small amount. Of course, more advanced methods outside the scope of Blender exist like our post processing method we introduced in 
<a href="../../research/coherent_splat_stylization">our paper</a>. As for the Watercolor and other painterly looks, you can definitely check the tools proposed by 
<a href="https://artineering.io/" target="_blank" rel="noopener">Artineering</a> !</p>
<p>You may also go further in shading control and tweak the normals of your model to get rid of unwanted artifacts. Indeed, if you want to go for anime style, unless you adapt the topology of your model to have sharp transitions and add/remove some shadows, you will have to tweak the normals. Inside Blender, you can edit your normals or you can use proxy objects to achieve a more consistent anime look. That is the topic of other tutorials you can find on the Internet but as a good start you can check the 
<a href="https://www.youtube.com/watch?v=yhGjCzxJV3E" target="_blank" rel="noopener">Guilty Gear GDC conference</a> that gives a good insight on how to achieve anime looking style in 3D.</p>
<p>There is a lot more to be discovered in that field of course, never stop exploring !</p>
<h2 id="tutorial-files-">Tutorial Files</h2>
<p>You can find this tutorial NPR material inside this 
<a href="/Files/shading_npr.blend">blend file</a> as well as the file generating the teaser image 
<a href="/Files/shading_samples.blend">here</a></p>

              </div>
              







<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=http://typhomnt.github.io/post/blender_npr/&amp;text=Making%20a%20NPR%20Shader%20in%20Blender" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=http://typhomnt.github.io/post/blender_npr/&amp;t=Making%20a%20NPR%20Shader%20in%20Blender" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Making%20a%20NPR%20Shader%20in%20Blender&amp;body=http://typhomnt.github.io/post/blender_npr/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=http://typhomnt.github.io/post/blender_npr/&amp;title=Making%20a%20NPR%20Shader%20in%20Blender" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Making%20a%20NPR%20Shader%20in%20Blender%20http://typhomnt.github.io/post/blender_npr/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=http://typhomnt.github.io/post/blender_npr/&amp;title=Making%20a%20NPR%20Shader%20in%20Blender" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  
  





  
    
    
    
      
    
    
    
    <div class="media author-card content-widget-hr">
      
        
        <img class="avatar mr-3 avatar-circle" src="/authors/admin/avatar_hu14fa9686a237893a821adc4e52dd5e2c_152507_270x270_fill_box_center_2.png" alt="">
      

      <div class="media-body">
        <h5 class="card-title"><a href="http://typhomnt.github.io/"></a></h5>
        <h6 class="card-subtitle">3D Expert. Computer graphics R&amp;D Freenlance.</h6>
        <p class="card-text">My research interests include character animation and non-photorealistic rendering.</p>
        <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:maxime.garcia1@ensimag.grenoble-inp.fr" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.com/citations?user=HKRJSQoAAAAJ&amp;hl=en&amp;oi=sra" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/typhomnt" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="/Files/Curriculum_vitae.pdf" >
        <i class="ai ai-cv"></i>
      </a>
    </li>
  
</ul>

      </div>
    </div>
  












  
  


            </div>
        </article>
  
      </main>
    </div>
  </div>
  

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.37431be2d92d7fb0160054761ab79602.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
